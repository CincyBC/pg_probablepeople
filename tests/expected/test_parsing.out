-- Regression tests for pg_probablepeople
CREATE EXTENSION pg_probablepeople;
-- Test 1: Tag a simple name (JSONB output)
SELECT tag_name('John Doe') ? 'tokens' AS has_tokens;
 has_tokens 
------------
 t
(1 row)

SELECT tag_name('John Doe') ? 'model_version' AS has_version;
 has_version 
-------------
 t
(1 row)

-- Test 2: Parse a simple name (Table output)
SELECT count(*) FROM parse_name('John Doe');
 count 
-------
     2
(1 row)

-- Should be at least 2 tokens (John, Doe)
-- Test 3: Parse with prefix
SELECT token, label FROM parse_name('Mr. John Doe');
 token |     label     
-------+---------------
 Mr.   | PrefixMarital
 John  | GivenName
 Doe   | Surname
(3 rows)

-- Test 4: Error handling (NULL input)
SELECT tag_name(NULL);
 tag_name 
----------
 
(1 row)

SELECT * FROM parse_name(NULL);
 token | label 
-------+-------
(0 rows)

-- Test 5: Parse with suffix
SELECT token, label FROM parse_name('John Doe Esq.');
 token |   label    
-------+------------
 John  | GivenName
 Doe   | MiddleName
 Esq.  | Surname
(3 rows)

-- Test 6: Parse with generational suffix
SELECT token, label FROM parse_name('John Doe III');
 token |       label        
-------+--------------------
 John  | GivenName
 Doe   | Surname
 III   | SuffixGenerational
(3 rows)

-- Test 7: Parse with prefix and suffix
SELECT token, label FROM parse_name('Dr. Hugh F Smission Jr.');
  token   |       label        
----------+--------------------
 Dr.      | PrefixOther
 Hugh     | GivenName
 F        | MiddleName
 Smission | Surname
 Jr.      | SuffixGenerational
(5 rows)

-- Test 8: Parse name with title
SELECT token, label FROM parse_name('President Joe Biden');
 token   |       label        
---------+----------------------
 President | Title
 Joe     | GivenName
 Biden   | Surname
(3 rows)

-- Clean up
DROP EXTENSION pg_probablepeople;
