-- Regression tests for pg_probablepeople
CREATE EXTENSION pg_probablepeople;
-- Test 1: Tag a simple name (JSONB output)
SELECT tag_name('John Doe') ? 'tokens' AS has_tokens;
 has_tokens 
------------
 t
(1 row)

SELECT tag_name('John Doe') ? 'model_version' AS has_version;
 has_version 
-------------
 t
(1 row)

-- Test 2: Parse a simple name (Table output)
SELECT count(*) FROM parse_name('John Doe');
 count 
-------
     2
(1 row)

-- Should be at least 2 tokens (John, Doe)
-- Test 3: Parse with prefix
SELECT token, label FROM parse_name('Mr. John Doe');
 token |     label     
-------+---------------
 Mr.   | PrefixMarital
 John  | GivenName
 Doe   | Surname
(3 rows)

-- Test 4: Error handling (NULL input)
SELECT tag_name(NULL);
 tag_name 
----------
 
(1 row)

SELECT * FROM parse_name(NULL);
 token | label 
-------+-------
(0 rows)

-- Test 5: Parse with suffix
SELECT token, label FROM parse_name('John Doe Esq.');
 token |    label    
-------+-------------
 John  | GivenName
 Doe   | Surname
 Esq.  | SuffixOther
(3 rows)

-- Test 6: Parse with generational suffix
SELECT token, label FROM parse_name('John Doe III');
 token |       label        
-------+--------------------
 John  | GivenName
 Doe   | Surname
 III   | SuffixGenerational
(3 rows)

-- Test 7: Parse with prefix and suffix
SELECT token, label FROM parse_name('Dr. Hugh F Smission Jr.');
  token   |       label        
----------+--------------------
 Dr.      | PrefixOther
 Hugh     | GivenName
 F        | MiddleInitial
 Smission | Surname
 Jr.      | SuffixGenerational
(5 rows)

-- Test 8: Parse name with title
SELECT token, label FROM parse_name('President Joe Biden');
   token   |    label    
-----------+-------------
 President | PrefixOther
 Joe       | GivenName
 Biden     | Surname
(3 rows)

-- Test 9: Test corporate name
SELECT token, label FROM parse_name('Google Inc.');
 token  |        label         
--------+----------------------
 Google | CorporationName
 Inc.   | CorporationLegalType
(2 rows)

-- Test 10: Test corporate name with suffix
SELECT token, label FROM parse_name('kam engineering inc.');
    token    |        label         
-------------+----------------------
 kam         | CorporationName
 engineering | CorporationName
 inc         | CorporationLegalType
(3 rows)

-- Test 11: Test corporate name with organization
SELECT token, label FROM parse_name('bipartisan sign co.');
   token    |            label            
------------+-----------------------------
 bipartisan | CorporationName
 sign       | CorporationName
 co         | CorporationNameOrganization
(3 rows)

-- Test 12: Column-based parsing
SELECT * FROM parse_name_cols('Mr. John Doe');
 prefix | given_name | middle_name | surname | suffix | nickname | corporation_name | corporation_type | organization | other 
--------+------------+-------------+---------+--------+----------+------------------+------------------+--------------+-------
 Mr.    | John       |             | Doe     |        |          |                  |                  |              | 
(1 row)

SELECT * FROM parse_name_cols('Google Inc.');
 prefix | given_name | middle_name | surname | suffix | nickname | corporation_name | corporation_type | organization | other 
--------+------------+-------------+---------+--------+----------+------------------+------------------+--------------+-------
        |            |             |         |        |          | Google           | Inc.             |              | 
(1 row)

SELECT prefix, given_name, surname, suffix, corporation_name FROM parse_name_cols('Dr. Jane Smith PhD');
 prefix | given_name | surname | suffix | corporation_name 
--------+------------+---------+--------+------------------
 Dr.    | Jane       | Smith   | PhD    | 
(1 row)

-- Clean up
DROP EXTENSION pg_probablepeople;
